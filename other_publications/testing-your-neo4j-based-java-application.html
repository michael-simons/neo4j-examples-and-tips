<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Michael Simons">
<title>Testing your Neo4j-based Java application</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article">
<div id="header">
<h1>Testing your Neo4j-based Java application</h1>
<div class="details">
<span id="author" class="author">Michael Simons</span><br>
<span id="email" class="email"><a href="mailto:michael.simons@neo4j.com">michael.simons@neo4j.com</a></span><br>
<span id="revnumber">version unspecified</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this post I&#8217;m gonna present different approaches how you can test your Neo4j-based application.
As you might know, Neo4j can be accessed from a variety of languages - Go, Python and JavaScript being some of them - this post focuses on Java based applications.
I&#8217;m an engineer on Neo4j&#8217;s Spring Data team, so this is where my focus usually is.</p>
</div>
<div class="paragraph">
<p>There are several aspects that needs to be considered while making the decision for or against a certain test setup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Are you developing a stored procedure for the database itself?</p>
</li>
<li>
<p>Are you using the official <a href="https://github.com/neo4j/neo4j-java-driver">Java-driver</a> to issue Cypher-queries directly over Bolt?</p>
</li>
<li>
<p>Are you using an Object-Graph-Mapping library like <a href="https://github.com/neo4j/neo4j-ogm">Neo4j-OGM</a> to build an application-side domain model?</p>
</li>
<li>
<p>Did you add <a href="https://github.com/spring-projects/spring-data-neo4j">Spring Data Neo4j</a> to the mix to take advantage of the Spring ecosystem?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I&#8217;ll cover those four scenarios which allow for a good comparison of the options we have at hand for testing queries or a domain model against the Neo4j database.</p>
</div>
<div class="paragraph">
<p>I&#8217;m gonna use <a href="https://junit.org/junit5/">JUnit 5</a> in all scenarios.
At the beginning of 2019, there&#8217;s hardly any reason not to use JUnit 5 in new projects.
All Neo4j specific techniques demonstrated in this post can be be applied with some adaption to JUnit 4 as well.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples in this article will all deal with spatial values and the functions defined there on.
The spatial datatype <code>point</code> is new since Neo4j 3.4 and Neo4j-OGM will support it out-of-the-box in Neo4j-OGM 3.2 and SDN 5.2.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neo4j_test_harness"><a class="anchor" href="#_neo4j_test_harness"></a>Neo4j test-harness</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The full example how to use the test-harness for custom Neo4j extension is on GitHub: <a href="https://github.com/michael-simons/neo4j-sdn-ogm-tips/tree/master/examples/using-the-test-harness">using-the-test-harness</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_testing_custom_neo4j_extensions"><a class="anchor" href="#_testing_custom_neo4j_extensions"></a>Testing custom Neo4j extensions</h3>
<div class="paragraph">
<p>Neo4j can be extended with <a href="https://neo4j.com/docs/java-reference/3.5/extending-neo4j/procedures/">custom procedures</a> and functions.
One can also add <a href="https://neo4j.com/docs/java-reference/3.5/extending-neo4j/http-server-extensions/">unmanaged server extensions</a> to Neo4j, that expose arbitrary JAX-RS endpoints from the database.
In all three of them one can interact directly with the database API for all kind of functions that require direct interaction with the kernel for the highest degree of performance or flexibility.</p>
</div>
<div class="paragraph">
<p>This is where the Neo4j test-harness comes in.
The test-harness is a special variant of an embedded Neo4j instance with hooks to provide test fixtures and adding your custom procedures and extensions.</p>
</div>
<div class="paragraph">
<p>Given the following user defined procedure, which is part of this <a href="https://github.com/michael-simons/neo4j-sdn-ogm-tips/tree/master/examples/using-the-test-harness">project</a>:</p>
</div>
<div id="location-conversion" class="listingblock">
<div class="title">Listing 1. LocationConversion.java, Converts legacy-style locations into proper points.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LocationConversion</span> {
    <span class="annotation">@Context</span>
    <span class="directive">public</span> GraphDatabaseService db;

    <span class="annotation">@Procedure</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">examples.convertLegacyLocation</span><span class="delimiter">&quot;</span></span>, mode = Mode.WRITE)
    <span class="directive">public</span> Stream&lt;NodeWrapper&gt; apply(<span class="annotation">@Name</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">nodes</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">List</span>&lt;Node&gt; nodes) {

        <span class="keyword">return</span> nodes.stream()
            .filter(LocationConversion::hasRequiredProperties)
            .map(LocationConversion::convertPropertiesToLocation)
            .map(NodeWrapper::<span class="keyword">new</span>);
    }

    <span class="directive">static</span> <span class="type">boolean</span> hasRequiredProperties(Node node) {
        <span class="keyword">return</span> node.hasProperty(PROPERTY_LONGITUDE) &amp;&amp; node.hasProperty(PROPERTY_LATITUDE);
    }

    <span class="directive">static</span> Node convertPropertiesToLocation(Node node) {

        <span class="type">double</span> lat = (<span class="type">double</span>) node.removeProperty(PROPERTY_LATITUDE);
        <span class="type">double</span> lon = (<span class="type">double</span>) node.removeProperty(PROPERTY_LONGITUDE);
        PointValue location = Values.pointValue(
            CoordinateReferenceSystem.WGS84, lon, lat);

        node.setProperty(PROPERTY_LOCATION, location);

        <span class="keyword">return</span> node;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LocationConversion</code> operates directly on the graph database nodes for optimal performance.
It is meant to be run server side with a call like this: <code>CALL examples.convertLegacyLocation(nodes)</code>.
If you followed the instructions on how to package your stored procedures you would have ended up with a JAR file containing the executable code.
Do you want to repackage it, stop your server and upload it everytime for testing it?
Probably not.</p>
</div>
<div class="paragraph">
<p>Enter the the test-harness:</p>
</div>
<div id="test-harness-dep" class="listingblock">
<div class="title">Listing 2. pom.xml, Dependencies for test-harness</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.neo4j.test<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-harness<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${neo4j.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s a variant <code>neo4j-harness-enterprise</code> that matches the commercial enterprise version of Neo4j, too.</p>
</div>
<div class="paragraph">
<p>With JUnit 5 you don&#8217;t need a <code>@Rule</code> to start it as JUnit 5 supports non-static initialization methods for tests when the lifecycle of the test is set to <code>PER_CLASS</code>.</p>
</div>
<div id="test-harness-setup" class="listingblock">
<div class="title">Listing 3. GeometryToolboxTest.java, Setup of the test-harness</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TestInstance</span>(TestInstance.Lifecycle.PER_CLASS) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="type">class</span> <span class="class">GeometryToolboxTest</span> {
    <span class="directive">private</span> Neo4j embeddedDatabaseServer; <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="annotation">@BeforeAll</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="type">void</span> initializeNeo4j() {

        <span class="local-variable">this</span>.embeddedDatabaseServer = Neo4jBuilders.newInProcessBuilder()
            .withProcedure(LocationConversion.class) <i class="conum" data-value="4"></i><b>(4)</b>
            .withFunction(GetGeometry.class)
            .withAggregationFunction(GetPolygon.class)
            .withFixture(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content"> CREATE (:Place {name: 'Malmö', longitude: 12.995098, latitude: 55.611730})</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content"> CREATE (:Place {name: 'Aachen', longitude: 6.083736, latitude: 50.776381})</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content"> CREATE (:Place {name: 'Lost place'})</span><span class="delimiter">&quot;</span></span>
            )
            .withDisabledServer()
            .build(); <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The lifecycle of this test should be <code>PER_CLASS, so that `initializeNeo4j()</code>, annotated with <code>@BeforeAll</code> runs exactly once.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The variable <code>embeddedDatabaseServer</code> to hold a reference to the server during all tests.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>initializeNeo4j()</code> runs before all tests and uses a builder to create a test server, the builder provides interfaces for registering</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>custom procedures and functions as well as</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>fixtures, either through Cypher statements like here, files or even functions.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>finally, start the server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now it&#8217;s really easy to use the server provided by the harness.
I have added the Java-Driver as test-dependency to the project and open up a connection as against a standalone server-instance or cluster:</p>
</div>
<div id="test-harness-usage1" class="listingblock">
<div class="title">Listing 4. GeometryToolboxTest.java, Example usage of the test server</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> shouldConvertLocations() {
    <span class="keyword">try</span> (var driver = GraphDatabase.driver(embeddedDatabaseServer.boltURI(), driverConfig);
        var session = driver.session()) {

        var result = session.run(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content"> MATCH (n:Place) WITH collect(n) AS nodes</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content"> CALL examples.convertLegacyLocation(nodes) YIELD node</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content"> RETURN node ORDER BY node.name</span><span class="delimiter">&quot;</span></span>);

        assertThat(result.stream())
            .hasSize(<span class="integer">2</span>)
            .extracting(r -&gt; {
                var node = r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">return</span> node.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span>).asPoint();
            })
            .containsExactly(
                Values.point(<span class="integer">4326</span>, <span class="float">6.083736</span>, <span class="float">50.776381</span>).asPoint(),
                Values.point(<span class="integer">4326</span>, <span class="float">12.995098</span>, <span class="float">55.611730</span>).asPoint()
            );
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_test_harness_for_application_level_tests"><a class="anchor" href="#_using_the_test_harness_for_application_level_tests"></a>Using the test-harness for application level tests</h3>
<div class="paragraph">
<p>Technically, the test-harness and the embedded server, reachable through <code>ServerControls</code>, can be used for application-level-testing.
Besides the Bolt-URI it exposes the HTTP-URI as well as the embedded graph database instance itself.
Both URIs use random, free ports and thus allow tests in parallel.
The <code>ServerControls</code> are an autoclosable resource and as they start relatively quick, they can be fired up multiple times.</p>
</div>
<div class="paragraph">
<p>It comes with a price, however:
In the end it is a full blown Neo4j instance with all the dependencies.
You might not want those dependencies in your application, not even in the test scope.
The other disadvantage is the fact, that you&#8217;re running the database inside the same JVM as your application.
Most of the time this is not what production looks like.
While being on the same JVM is the correct place for stored procedures, it is not for applications.
Using an embedded database for testing your application code might lead you into a false sense of safety.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neo4j_testcontainer"><a class="anchor" href="#_neo4j_testcontainer"></a>Neo4j Testcontainer</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The full example how to use the Testcontainers Spring Data Neo4j based applications is on GitHub: <a href="https://github.com/michael-simons/neo4j-sdn-ogm-tips/tree/master/examples/using-testcontainers">using-testcontainers</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>What are <a href="https://www.testcontainers.org">Testcontainers</a>?</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Testcontainers is a Java library that supports JUnit tests, providing lightweight, throwaway instances of common databases, Selenium web browsers, or anything else that can run in a Docker container.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Testcontainers.org
</div>
</div>
<div class="paragraph">
<p><a href="http://twitter.com/frant_hartm">František Hartman</a> from  GraphAware wrote a very details article about <a href="https://graphaware.com/docker,/testing/2018/12/16/integration-testing-with-docker-neo4j-image-and-testcontainers.html">Integration testing with Docker Neo4j image and Testcontainers</a>.
František already covered a lot here and you should check this out.</p>
</div>
<div class="paragraph">
<p>In the meantime, our pull request has landed in Testcontainers.
<a href="https://www.testcontainers.org/usage/neo4j_container.html">Neo4j container</a> describes the basic usage of the official container.</p>
</div>
<div class="sect2">
<h3 id="_general_setup_of_testcontainers_with_junit_5"><a class="anchor" href="#_general_setup_of_testcontainers_with_junit_5"></a>General setup of Testcontainers with JUnit 5</h3>
<div class="paragraph">
<p>As stated earlier, I have become a big fan of JUnit 5.
Nice assertions are one reason, package private test methods, better lifecycle management and extensions are another.</p>
</div>
<div class="paragraph">
<p>Testcontainers comes with support for JUnit 5.
<a href="#testcontainers-neo4j-junit5-deps">Listing 5</a> shows all the necessary dependencies:</p>
</div>
<div id="testcontainers-neo4j-junit5-deps" class="listingblock">
<div class="title">Listing 5. pom.xml, Dependencies for JUnit, Testcontainers and the Neo4j Testcontainer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.junit.jupiter<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>junit-jupiter-engine<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${junit-jupiter.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.testcontainers<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${testcontainers.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.testcontainers<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>junit-jupiter<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${testcontainers.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At the time of writing, <code>testcontainers.version</code> is <code>1.10.5</code> and <code>junit-jupiter.version</code> is <code>5.3.2</code>.</p>
</div>
<div class="paragraph">
<p>I recommend the following setup for an integration test with Testcontainers:</p>
</div>
<div id="minimal-neo4j-testcontainer-setup" class="listingblock">
<div class="title">Listing 6. PlainOGMTest.java, Mininal test setup</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Testcontainers</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PlainOGMTest</span> {

    <span class="annotation">@Container</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Neo4jContainer databaseServer = <span class="keyword">new</span> Neo4jContainer(); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When run, extend this test-class with the <code>@Testcontainers</code> extension</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The extension will look for all attributes marked as <code>@Container</code> and start and stop them according to their lifecycle. Here, <code>databaseServer</code> points to our Neo4j Testcontainer.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create (but don&#8217;t start) a <code>Neo4jContainer</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As JUnit 5 tests have a default lifecycle of <code>PER_METHOD</code>, shared state needs to be defined as static attributes of the test.
Hence, the definition of the Testcontainer as a <code>static</code> attribute.
This way, the  container is started before all tests and closed afterwards.
If the container is defined as an instance attribute, it&#8217;s restarted before each individual test.</p>
</div>
<div class="paragraph">
<p>While it is possible to change the lifecycle of the test class to <code>PER_CLASS</code> instead of <code>PER_METHOD</code>, it&#8217;s a bit harder later on to configure it for Spring Boot Test-Slices.</p>
</div>
<div class="paragraph">
<p>Also applicable for both plain Neo4j-OGM and SDN test is the way to provide a test-fixture.
This can be done in a <code>@BeforeAll</code> method like this:</p>
</div>
<div id="prepare-test-data" class="listingblock">
<div class="title">Listing 7. PlainOGMTest.java, Prepare test data</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> TEST_DATA = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> MERGE (:Thing {name: 'Thing'  })</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> MERGE (:Thing {name: 'Thing 2'})</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> MERGE (:Thing {name: 'Thing 3'})</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content"> CREATE (:Thing {name: 'A box', geometry: [</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">   point({x:  0, y:  0}), </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">   point({x: 10, y:  0}), </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">   point({x: 10, y: 10}), </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">   point({x:  0, y: 10}), </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">   point({x:  0, y:  0})] }</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">)</span><span class="delimiter">&quot;</span></span>;

<span class="annotation">@BeforeAll</span>
<span class="directive">static</span> <span class="type">void</span> prepareTestdata() {
    <span class="predefined-type">String</span> password = databaseServer.getAdminPassword(); <i class="conum" data-value="1"></i><b>(1)</b>

    AuthToken authToken = AuthTokens.basic(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>, password);
    <span class="keyword">try</span> (var driver = GraphDatabase.driver(databaseServer.getBoltUrl(), authToken); <i class="conum" data-value="2"></i><b>(2)</b>
        var session = driver.session()
    ) {
        session.writeTransaction(work -&gt; work.run(TEST_DATA));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>databaseServer</code> is the container we defined and started above. It provides access to the databases password</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The container provides an accessor to the Bolt-URI which contains a random port</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@BeforeAll</code> method is invoked once before all tests.
I provide the test data over Bolt, so I have the Neo4j Java-Driver on the classpath.
Having a static string here is one option, but you can read in your test-data anyway you want.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_with_neo4j_ogm"><a class="anchor" href="#_using_with_neo4j_ogm"></a>Using with Neo4j-OGM</h3>
<div class="paragraph">
<p>The only thing you need to test your business logic based on Neo4j-OGM and queries is a Neo4j-OGM <code>SessionFactory</code>.
I recommend defining it as a static variable through a second <code>@BeforeAll</code> method in the test as well:</p>
</div>
<div id="prepare-sessionfactory" class="listingblock">
<div class="title">Listing 8. PlainOGMTest.java, Create the <code>SessionFactory</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> SessionFactory sessionFactory;

<span class="annotation">@BeforeAll</span>
<span class="directive">static</span> <span class="type">void</span> prepareSessionFactory() {

    var ogmConfiguration = <span class="keyword">new</span> <span class="predefined-type">Configuration</span>.Builder()
        .uri(databaseServer.getBoltUrl())
        .credentials(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>, databaseServer.getAdminPassword())
        .build();

    sessionFactory = <span class="keyword">new</span> SessionFactory(
        ogmConfiguration,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">org.neo4j.tips.testing.using_testcontainers.domain</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again: No hardcoded password, no hardcoded Bolt-URI.
The Neo4j-Testcontainer provides this.</p>
</div>
<div class="paragraph">
<p>One possible test with the above data could be this:</p>
</div>
<div id="example-test" class="listingblock">
<div class="title">Listing 9. PlainOGMTest.java, A simple test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> someQueryShouldWork() {

    var query = <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (t:Thing) WHERE t.name =~ $name RETURN t</span><span class="delimiter">&quot;</span></span>;
    var result = sessionFactory.openSession()
        .query(query, <span class="predefined-type">Map</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Thing </span><span class="char">\\</span><span class="content">d</span><span class="delimiter">&quot;</span></span>));

    assertThat(result).hasSize(<span class="integer">2</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This test runs over the network against a "real", server-mode Neo4j-instance.
Just as your application hopefully will.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_with_neo4j_ogm_and_sdn_dataneo4jtest"><a class="anchor" href="#_using_with_neo4j_ogm_and_sdn_dataneo4jtest"></a>Using with Neo4j-OGM and SDN, DataNeo4jTest</h3>
<div class="paragraph">
<p>For me there&#8217;s no good reasons to start new Spring projects without Spring Boot.
Spring Boot brings you - among other nice things - <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">autoconfigured tests</a> and more important, test slices.
Test slices deal specifically with certain, technical layers of your application.
Being either database layer, service layer or just the web-frontend.</p>
</div>
<div class="paragraph">
<p>Regarding the database layer it&#8217;s an integration test very much focussed on interaction with the database.</p>
</div>
<div class="paragraph">
<p>The Neo4j test-slice is called <code>@DataNeo4jTest</code></p>
</div>
<div id="sdn-neo4j-testcontainer-setup" class="listingblock">
<div class="title">Listing 10. SDNTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Testcontainers</span>
<span class="annotation">@DataNeo4jTest</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SDNTest</span> {

    <span class="annotation">@TestConfiguration</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {

        <span class="annotation">@Bean</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="directive">public</span> org.neo4j.ogm.config.Configuration configuration() {
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Configuration</span>.Builder()
                .uri(databaseServer.getBoltUrl())
                .credentials(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>, databaseServer.getAdminPassword())
                .build();
        }
    }

    <span class="directive">private</span> <span class="directive">final</span> ThingRepository thingRepository;

    <span class="annotation">@Autowired</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="directive">public</span> SDNTest(ThingRepository thingRepository) {
        <span class="local-variable">this</span>.thingRepository = thingRepository;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This activates Spring Datas repository layer and also provides Spring Boot&#8217;s JUnit 5 extensions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>@TestConfiguration</code> adds to Spring Boots config but doesn&#8217;t prevent autoconfiguration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A bean of Neo4j-OGMs configuration will be created to configure the <code>SessionFactory</code> of Spring Data Neo4j</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>JUnit 5 together with Spring Boots extension allow constructor based injection, even in tests</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can test against the <code>ThingRepository</code> which is shown in <a href="#thing-repository">Listing 11</a></p>
</div>
<div id="thing-repository" class="listingblock">
<div class="title">Listing 11. ThingRepository.java, a Spring Data Neo4j repository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ThingRepository</span> <span class="directive">extends</span> Neo4jRepository&lt;Thing, <span class="predefined-type">Long</span>&gt; {

    <span class="predefined-type">List</span>&lt;Thing&gt; findThingByNameMatchesRegex(<span class="predefined-type">String</span> regexForName);

    <span class="annotation">@Query</span>(value
        = <span class="string"><span class="delimiter">&quot;</span><span class="content"> MATCH (t:Thing) WHERE t.name = $name</span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content"> RETURN t.name AS name, examples.getGeometry(t) AS wkt</span><span class="delimiter">&quot;</span></span>)
    ThingWithGeometry findThingWithGeometry(<span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A "boring" test would look like this:</p>
</div>
<div id="boring-sdn-test" class="listingblock">
<div class="title">Listing 12. SDNTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> someQueryShouldWork() {

    var things = thingRepository.findThingByNameMatchesRegex(<span class="string"><span class="delimiter">&quot;</span><span class="content">Thing </span><span class="char">\\</span><span class="content">d</span><span class="delimiter">&quot;</span></span>);
    assertThat(things).hasSize(<span class="integer">2</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Why is this boring?
Because we&#8217;re basically testing whether Spring Datas query derivation works or not.</p>
</div>
<div class="paragraph">
<p>Testing <code>findThingWithGeometry</code> is much more interesting, as you may recognize <code>examples.getGeometry(t)</code> as our own, custom procedure.
How do we get this into the test container?
Turns out the authors of Testcontainers thought of a method to mount stuff in the container before it starts.</p>
</div>
<div class="paragraph">
<p>I packaged the custom stored procedures from the beginning of this article into a JAR files name <code>geometry-toolbox.jar</code> and added it to the test resources.
With this the Testcontainer can be created like this:</p>
</div>
<div id="copy-plugin" class="listingblock">
<div class="title">Listing 13. SDNTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Container</span>
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> Neo4jContainer databaseServer = <span class="keyword">new</span> Neo4jContainer&lt;&gt;()
    .withCopyFileToContainer(
        MountableFile.forClasspathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/geometry-toolbox.jar</span><span class="delimiter">&quot;</span></span>),
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/var/lib/neo4j/plugins/</span><span class="delimiter">&quot;</span></span>)
    .withClasspathResourceMapping(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-graph.db</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/data/databases/graph.db</span><span class="delimiter">&quot;</span></span>, BindMode.READ_WRITE)
    .withEnv(<span class="string"><span class="delimiter">&quot;</span><span class="content">NEO4J_dbms_security_procedures_unrestricted</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">apoc.*,algo.*</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin-jar gets copied into the right place inside the container and is recognized by Neo4j during startup.
The test data for the second test isn&#8217;t hardcoded like in <code>PlainOGMTest.java</code>.
I copied over the <code>graph.db</code> folder from my "production" instance to the test resources.
Calling <code>withClasspathResourceMapping()</code> maps it into the containers <code>/data/</code> volume, where Neo4j expects the database.
In a real-world test you probably have that data folder somewhere else and not in your project.
In such cases, you would use <code>withFileSystemBind()</code> of the Testcontainer.</p>
</div>
<div class="paragraph">
<p>In the setup above, <code>withEnv()</code> is used to remove any security restrictions from APOC and algorithms extensions by setting <code>NEO4J_dbms_security_procedures_unrestricted</code>.</p>
</div>
<div class="paragraph">
<p>Anyway, given the same test data as in <a href="#prepare-test-data">Listing 7</a>, a not so boring test now is green:</p>
</div>
<div id="not-boring-sdn-test" class="listingblock">
<div class="title">Listing 14. SDNTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> customProjectionShouldWork() {

    var expectedWkt
        = <span class="string"><span class="delimiter">&quot;</span><span class="content">LINESTRING (0.000000 0.000000,</span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">10.000000 0.000000,</span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">10.000000 10.000000,</span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">0.000000 10.000000,</span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">0.000000 0.000000)</span><span class="delimiter">&quot;</span></span>;

    var thingWithGeometry = thingRepository.findThingWithGeometry(<span class="string"><span class="delimiter">&quot;</span><span class="content">A box</span><span class="delimiter">&quot;</span></span>);
    assertThat(thingWithGeometry).isNotNull()
        .extracting(ThingWithGeometry::getWkt)
        .isEqualTo(expectedWkt);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And with that, we just have tested an Spring Data Neo4j based Neo4j-application including custom plugins end-to-end.
Starting with the plugins and ending up with an integration test.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h3>
<div class="paragraph">
<p>When writing custom extensions, you want a quick feedback loop for all of your tests.
You&#8217;re also very close to the server in all cases.
The test-harness provides you with the fastest feedback loop possible and doesn&#8217;t expose your code to more than you actually need.
Your code is right there at the server level.
The test-harness and the embedded, customizable instance of Neo4j should be your first choice when testing custom Neo4j extensions.
It is also a good choice for infrastructure code like Neo4j-OGM and Spring Data Neo4j itself.
Neo4j-OGM runs against an embedded graph, over Bolt and HTTP, so it must be tested against all of those.
The test-harness provides good support for that.</p>
</div>
<div class="paragraph">
<p>The main advantage of using a Testcontainer is the fact that it resembles your later application setup the best.
While there are some use cases, most applications should not run an embedded version of Neo4j.
Think about it: In a microservices world, where you have usually more than one instance of an application running, should each instance bring it&#8217;s own database?
You cannot run Neo4j in <a href="https://neo4j.com/docs/operations-manual/current/clustering/">Causal Cluster mode</a> in an embedded scenario, so you have to synchronize those instances.
Furthermore: If your application goes down, so would your database.</p>
</div>
<div class="paragraph">
<p>The generic Testcontainer or the dedicated Neo4j-Testcontainer gives an easy way to bring up new, clean database instances for each test.
Thus, your tests are independent of each other and you won&#8217;t have interference in your test data from concurrent tests.</p>
</div>
<div class="paragraph">
<p>So please keep the following in mind while your design your integration tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The topology of your test should reassemble your target topology as much as possible</p>
</li>
<li>
<p>Try to use a dataset that is comparable in size to your production dataset</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Testcontainers help a lot to achieve the first item.
Whether you can get your hands on a dataset that is similar to your production data set, depends probably on your surroundings and organization.
If it is possible however, you could create a custom Neo4j Docker image and use that one as a basis for the Testcontainer in your CI.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version unspecified<br>
Last updated 2022-02-28 09:59:34 UTC
</div>
</div>
</body>
</html>